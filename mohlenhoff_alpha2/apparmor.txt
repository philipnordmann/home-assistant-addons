#include <tunables/global>

profile mohlenhoff_alpha2 flags=(attach_disconnected,mediate_deleted) {
  #include <abstractions/base>
  
  # Allow network access
  network inet tcp,
  network inet udp,
  
  # Files required for the add-on to function
  /bin/** ix,
  /usr/bin/** ix,
  /usr/local/bin/** ix,
  /usr/lib/** mr,
  /lib/** mr,
  
  # Python
  /usr/bin/python3 ix,
  /usr/lib/python3* mr,
  /usr/lib/python3*/** mr,
  
  # Home Assistant API access
  /usr/bin/curl ix,
  /usr/bin/wget ix,
  
  # Add-on directory access
  /data/** rw,
  /data/ rw,
  /share/** r,
  
  # Allow reading configuration
  /etc/hosts r,
  /etc/resolv.conf r,
  /etc/ssl/** r,
  
  # Allow script execution
  /usr/bin/alpha2_client.py r,
  /usr/bin/alpha2_integration.py r,
  /usr/bin/alpha2_client.py rix,
  /usr/bin/alpha2_integration.py rix,
  
  # Allow log writes
  /dev/stdout w,
  /dev/stderr w,
  /proc/*/fd/ r,
  /proc/*/fd/* r,
  
  # Capabilities
  capability net_bind_service,
  capability net_admin,
  
  # S6-Overlay & System
  /init ix,
  /bin/s6** ix,
  /bin/su ix,
  /bin/echo ix,
  /etc/services.d/** rwix,
  /run/** rwk,
  /dev/tty rw,
  
  # Self files
  /app/** r,
  /etc/** r,
  /etc/passwd r,
  /etc/group r,
}